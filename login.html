<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SecureATM - Account Login</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-grid"></div>
    <div class="floating-elements">
        <div class="floating-element"></div>
        <div class="floating-element"></div>
        <div class="floating-element"></div>
    </div>
    
    <header class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-container">
                    <img src="atm.png" alt="ATM Icon" class="atm-icon">
                    <span class="logo-text">SecureATM</span>
                </div>
            </a>
            <nav class="nav-menu">
                <a href="index.html#features" class="nav-link">
                    <span>Features</span>
                </a>
                <a href="index.html#about-us" class="nav-link">
                    <span>About Us</span>
                </a>
                <div class="dropdown">
                    <a href="javascript:void(0)" class="nav-link dropbtn" onclick="toggleDropdown()">
                        <span>Contact</span>
                        <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M6 9l6 6 6-6"/>
                        </svg>
                    </a>
                    <div class="dropdown-content" id="dropdownContent">
                        <a href="mailto:1755vijay1755@gmail.com" class="dropdown-item">
                            <img src="email.png" alt="Email Icon" class="icon">
                            <span>1755vijay1755@gmail.com</span>
                        </a>
                        <a href="tel:+919502013178" class="dropdown-item">
                            <img src="telephone.png" alt="Phone Icon" class="icon">
                            <span>+91 9502013178</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
        
        <script>
            function toggleDropdown() {
                const dropdown = document.getElementById('dropdownContent');
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
            }
            window.onclick = function(event) {
                const dropdown = document.getElementById('dropdownContent');
                if (!event.target.matches('.dropbtn') && !event.target.closest('.dropbtn')) {
                    dropdown.style.display = 'none';
                }
            }
        </script>
    </header>

    <main class="login-main">
        <div class="login-container">
            <div class="card">
                <div class="card-header">
                    <div class="security-badge">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        <span>Bank-level Security</span>
                    </div>
                    <div class="card-title-section">
                        <h2 class="card-title">Account Access</h2>
                        <p class="card-subtitle">Enter your banking credentials to continue</p>
                    </div>
                </div>

                <form id="withdrawal-form" class="form" novalidate>
                    <div class="input-group">
                        <label for="ifscCode" class="input-label">IFSC Code</label>
                        <div class="input-container">
                            <input type="text" id="ifscCode" placeholder="e.g., HDFC0001234" required data-error="*IFSC Code is required.">
                            <div class="input-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                                </svg>
                            </div>
                        </div>
                        <span class="error-tooltip"></span>
                    </div>

                    <div class="input-group">
                        <label for="accountNumber" class="input-label">Account Number</label>
                        <div class="input-container">
                            <input type="text" id="accountNumber" placeholder="Enter your account number" required data-error="*Account number is required.">
                            <div class="input-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                    <line x1="1" y1="10" x2="23" y2="10"/>
                                </svg>
                            </div>
                        </div>
                        <span class="error-tooltip"></span>
                    </div>

                    <div class="input-group">
                        <label for="pinNumber" class="input-label">PIN Number</label>
                        <div class="input-container">
                            <input type="password" id="pinNumber" placeholder="Enter your 4-digit PIN" required data-error="*PIN number is required.">
                            <div class="input-icon">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <circle cx="12" cy="16" r="1"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                            </div>
                        </div>
                        <span class="error-tooltip"></span>
                        <a href="change-pin.html" class="change-pin-link">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                            Change PIN
                        </a>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <span class="btn-text">Authenticate</span>
                        <div class="btn-loader"></div>
                        <svg class="btn-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14m-7-7l7 7-7 7"/>
                        </svg>
                    </button>
                </form>

                <div id="success-message" class="message success-message"></div>
                <div id="error-message" class="message error-message"></div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 SecureATM - Your trusted banking partner</p>
            <div class="footer-badges">
                <span class="badge">SSL Encrypted</span>
                <span class="badge">PCI Compliant</span>
            </div>
        </div>
    </footer>

    <script src="config.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD11TKGJ_hvH2Q2PEONR3Rv6T4bMuKUGWI",
            authDomain: "atm-dispenser.firebaseapp.com",
            projectId: "atm-dispenser",
            storageBucket: "atm-dispenser.appspot.com",
            messagingSenderId: "475421852141",
            appId: "1:475421852141:web:750aed1bffaf2dddc867e4",
            measurementId: "G-70F1QRCM5Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
    
        document.getElementById('withdrawal-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('.submit-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            const btnLoader = submitBtn.querySelector('.btn-loader');
            
            submitBtn.classList.add('loading');
            btnText.textContent = 'Authenticating...';
            
            let formValid = true;
            
            document.querySelectorAll('.error-tooltip').forEach(tooltip => {
                tooltip.style.display = 'none';
                tooltip.textContent = '';
            });
            
            // Validate required fields
            document.querySelectorAll('input[required]').forEach((input) => {
                const inputGroup = input.closest('.input-group');
                const errorTooltip = inputGroup.querySelector('.error-tooltip');
                if (!input.value.trim()) {
                    errorTooltip.textContent = input.getAttribute('data-error');
                    errorTooltip.style.display = 'block';
                    formValid = false;
                }
            });
            
            if (formValid) {
                const ifscCode = document.getElementById('ifscCode').value;
                const accountNumber = document.getElementById('accountNumber').value;
                const pinNumber = document.getElementById('pinNumber').value;
                fetchUserData(ifscCode, accountNumber, pinNumber);
            } else {
                submitBtn.classList.remove('loading');
                btnText.textContent = 'Authenticate';
            }
        });
    
        async function fetchUserData(ifscCode, accountNumber, pinNumber) {
            const userRef = collection(db, 'users');
            const q = query(userRef, where('accountNumber', '==', accountNumber));
    
            try {
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) {
                    showError('Account number not found.');
                } else {
                    let userFound = false;
                    querySnapshot.forEach((doc) => {
                        const userData = doc.data();
                        if (userData.pinNumber === pinNumber) {
                            userFound = true;
                            localStorage.setItem('accountNumber', accountNumber);
                            showSuccess('Authentication successful! Redirecting...');
                            
                            setTimeout(() => {
                                window.location.href = 'confirm.html';
                            }, 2000);
                        }
                    });
        
                    if (!userFound) {
                        showError('Incorrect PIN. Please try again.');
                    }
                }
            } catch (error) {
                showError('Authentication failed. Please try again.');
            }
            
            const submitBtn = document.querySelector('.submit-btn');
            const btnText = submitBtn.querySelector('.btn-text');
            submitBtn.classList.remove('loading');
            btnText.textContent = 'Authenticate';
        }
    
        function showSuccess(message) {
            const successMessage = document.getElementById('success-message');
            successMessage.textContent = message;
            successMessage.style.display = 'flex';
            successMessage.style.animation = 'slideInUp 0.5s ease-out';
        }
    
        function showError(message) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorMessage.style.display = 'flex';
            errorMessage.style.animation = 'slideInUp 0.5s ease-out';
        }
    </script>
</body>
</html>